<!DOCTYPE html>
<html>
<head>
    <title>Test Komodo API</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #0070f3; color: white; border: none; border-radius: 5px; }
        button:hover { background: #0051cc; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .loading { color: #666; font-style: italic; }
        .error { color: red; }
        .success { color: green; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        h2 { color: #0070f3; }
    </style>
</head>
<body>
    <h1>üö¢ Test Komodo Cruises API</h1>
    
    <div class="section">
        <h2>1. Test Operators</h2>
        <button onclick="testOperators()">Get Operators</button>
        <div id="operators-result"></div>
    </div>

    <div class="section">
        <h2>2. Test Cabins List</h2>
        <button onclick="testCabins()">Get All Cabins</button>
        <div id="cabins-result"></div>
    </div>

    <div class="section">
        <h2>3. Test Availability</h2>
        <input type="date" id="availability-date" value="2026-01-15" />
        <button onclick="testAvailability()">Check Availability</button>
        <div id="availability-result"></div>
    </div>

    <div class="section">
        <h2>4. Test Cabin Detail</h2>
        <button onclick="testCabinDetail()">Get Cabin Details</button>
        <div id="detail-result"></div>
    </div>

    <div class="section">
        <h2>5. Test Search</h2>
        <input type="date" id="search-date" value="2026-01-15" />
        <input type="text" id="cabin-name" placeholder="Cabin name (e.g., Deluxe)" />
        <input type="number" id="guests" value="2" min="1" />
        <button onclick="testSearch()">Search Cabin</button>
        <div id="search-result"></div>
    </div>

    <script>
        const API_URL = 'https://ff8b64b78031.ngrok-free.app';

        async function fetchAPI(params) {
            const url = new URL(API_URL);
            Object.keys(params).forEach(key => url.searchParams.append(key, params[key]));
            const response = await fetch(url, {
                headers: {
                    'ngrok-skip-browser-warning': 'true'
                }
            });
            return response.json();
        }

        function showResult(elementId, data, error = null) {
            const el = document.getElementById(elementId);
            if (error) {
                el.innerHTML = `<p class="error">‚ùå Error: ${error}</p>`;
                return;
            }
            el.innerHTML = `<p class="success">‚úÖ Success!</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<p class="loading">‚è≥ Loading...</p>';
        }

        async function testOperators() {
            showLoading('operators-result');
            try {
                const data = await fetchAPI({ resource: 'operators' });
                showResult('operators-result', data);
            } catch (err) {
                showResult('operators-result', null, err.message);
            }
        }

        async function testCabins() {
            showLoading('cabins-result');
            try {
                const data = await fetchAPI({ resource: 'cabins' });
                showResult('cabins-result', data);
            } catch (err) {
                showResult('cabins-result', null, err.message);
            }
        }

        async function testAvailability() {
            showLoading('availability-result');
            try {
                const date = document.getElementById('availability-date').value;
                const data = await fetchAPI({ resource: 'availability', date });
                showResult('availability-result', data);
            } catch (err) {
                showResult('availability-result', null, err.message);
            }
        }

        async function testCabinDetail() {
            showLoading('detail-result');
            try {
                const data = await fetchAPI({ resource: 'cabindetail' });
                showResult('detail-result', data);
            } catch (err) {
                showResult('detail-result', null, err.message);
            }
        }

        async function testSearch() {
            showLoading('search-result');
            try {
                const date = document.getElementById('search-date').value;
                const name = document.getElementById('cabin-name').value;
                const guests = document.getElementById('guests').value;
                const data = await fetchAPI({ resource: 'search', date, name, guests });
                showResult('search-result', data);
            } catch (err) {
                showResult('search-result', null, err.message);
            }
        }
    </script>
</body>
</html>
